# 會員方案功能 APP 操作指南

本指南說明如何在 KickRoll APP 中操作和驗證會員方案功能。

## 🚀 功能概述

已實現的會員方案管理功能包括：
- 查看會員所有方案
- 新增會員方案（計次/包月）
- 編輯方案狀態和剩餘堂數
- 調整方案堂數（正負數調整）
- 方案狀態篩選和自動過期處理

## 📱 APP 操作步驟

### 1. 進入會員方案管理

1. 啟動 KickRoll APP
2. 進入「成員列表」頁面
3. 選擇任一成員，進入「編輯成員」頁面
4. 點擊「**管理方案**」按鈕（紫色按鈕）
5. 進入該成員的「會員方案」頁面

### 2. 查看現有方案

在會員方案頁面，你可以看到：
- 會員基本資訊（姓名、ID）
- 狀態篩選器（全部/active/expired/suspended）
- 方案列表，每個方案顯示：
  - 方案名稱和類型標籤（計次/包月）
  - 剩餘堂數資訊
  - 有效期限
  - 狀態標籤（啟用/過期/暫停）
  - 操作按鈕（調整堂數、編輯方案）

### 3. 新增方案

1. 點擊右下角綠色「**+**」按鈕
2. 在「新增會員方案」頁面填寫：
   - **方案類型**：選擇「計次」（按堂數計費）或「包月」（按月計費）
   - **方案名稱**：如「10堂計次課程」或「包月課程」
   - **總堂數**：僅計次需要填寫
   - **剩餘堂數**：初始剩餘堂數
   - **生效日期**：可選，勾選後設定
   - **到期日期**：包月必須設定，計次可選
   - **狀態**：通常選「active」
3. 點擊「**儲存方案**」

### 4. 調整堂數

1. 在方案列表中點擊任一方案的「**調整堂數**」按鈕
2. 在彈出的對話框中：
   - 查看目前剩餘堂數
   - 輸入調整數量（正數增加，負數減少，如：+5、-2）
   - 輸入調整原因（可選）
3. 點擊「**確定**」
4. 系統會自動重新載入並顯示更新後的堂數

### 5. 編輯方案

1. 點擊方案的「**編輯方案**」按鈕
2. 在「編輯會員方案」頁面可修改：
   - 剩餘堂數
   - 方案狀態
3. 點擊「**儲存變更**」

### 6. 篩選方案

使用頁面上方的狀態篩選器：
- **全部**：顯示所有方案
- **active**：僅顯示啟用的方案
- **expired**：僅顯示過期的方案
- **suspended**：僅顯示暫停的方案

## 🧪 測試案例建議

### 測試案例 1：建立計次課程
1. 新增方案：類型「計次」，名稱「10堂計次課程」，總堂數「10」，剩餘堂數「10」
2. 驗證：方案顯示「剩餘: 10 / 10 堂」

### 測試案例 2：建立包月課程
1. 新增方案：類型「包月」，名稱「包月課程」，剩餘堂數「0」，設定到期日期為一個月後
2. 驗證：方案顯示到期日期，總堂數為空

### 測試案例 3：堂數調整
1. 選擇一個計次課程方案
2. 調整堂數「-1」，原因「上課出席」
3. 驗證：剩餘堂數減少 1

### 測試案例 4：嘗試負數堂數
1. 嘗試調整堂數使其變為負數
2. 驗證：系統拒絕並顯示錯誤訊息

### 測試案例 5：狀態篩選
1. 建立不同狀態的方案（active、suspended）
2. 使用篩選器查看不同狀態的方案
3. 驗證：篩選功能正常運作

## 🔧 技術說明

### API 端點測試
APP 會呼叫以下 API 端點：
- `GET /api/members/{id}/plans` - 取得會員方案列表
- `POST /api/members/{id}/plans` - 建立新方案
- `PATCH /api/members/{id}/plans/{planId}` - 更新方案
- `POST /api/members/{id}/plans/{planId}:adjust` - 調整堂數

### 資料驗證
- 方案名稱不可空白
- 剩餘堂數必須為非負整數
- 期限票必須設定到期日期
- 堂數調整不可導致負數

### 自動功能
- 過期方案自動標記（當查詢時檢查 ValidUntil）
- 頁面返回時自動重新整理資料
- 操作成功後自動更新顯示

## 📝 注意事項

1. **API 位址**：確保 `_httpClient.BaseAddress` 設定正確（目前設為 `http://localhost:5112/`）
2. **網路連接**：需要確保 APP 能連接到 API 伺服器
3. **資料持久化**：所有操作都會即時儲存到 Firestore
4. **錯誤處理**：操作失敗時會顯示具體錯誤訊息

透過這個 APP 界面，你可以完整測試所有會員方案相關的 API 功能，包括 CRUD 操作、商業規則驗證、和狀態管理等。